document.addEventListener("DOMContentLoaded", () => {
  const formularios = document.querySelectorAll("form");

  formularios.forEach((form) => {
    form.addEventListener("submit", function (e) {
      limpiarErrores();
      let valido = true;

      // ===== TEXTOS (mínimo 3 caracteres) =====
      const textos = ["nombre", "descripcion", "color", "aroma"];

      textos.forEach((id) => {
        const input = document.getElementById(id);
        if (input && input.value.trim().length < 3) {
          mostrarError(input, "Debe tener al menos 3 caracteres");
          valido = false;
        }
      });

      // ===== PRECIO =====
      const precio = document.getElementById("precio");
      if (precio) {
        if (precio.value === "" || parseFloat(precio.value) <= 0) {
          mostrarError(precio, "El precio debe ser mayor que 0");
          valido = false;
        }
      }

      // ===== STOCK =====
      const stock = document.getElementById("stock");
      if (stock) {
        if (!Number.isInteger(Number(stock.value)) || Number(stock.value) < 0) {
          mostrarError(stock, "El stock debe ser un número entero no negativo");
          valido = false;
        }
      }

      // ===== CATEGORÍA =====
      const categoria = document.getElementById("id_categoria");
      if (categoria && categoria.value === "") {
        mostrarError(categoria, "Debe seleccionar una categoría");
        valido = false;
      }

      if (!valido) {
        e.preventDefault();
      }
    });
  });

  // ===== FUNCIONES =====
  function mostrarError(input, mensaje) {
    const div = document.createElement("div");
    div.className = "text-danger mt-1";
    div.innerText = mensaje;
    input.classList.add("is-invalid");
    input.parentNode.appendChild(div);
  }

  function limpiarErrores() {
    document.querySelectorAll(".text-danger").forEach((e) => e.remove());
    document
      .querySelectorAll(".is-invalid")
      .forEach((e) => e.classList.remove("is-invalid"));
  }
});
